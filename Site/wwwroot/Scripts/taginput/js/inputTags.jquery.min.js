!function(t){t.fn.inputTags=function(e){if("inputTags"in window||(window.inputTags={instances:[]}),window.inputTags.methods={tags:function(t,e){if(t){switch(typeof t){case"string":switch(t){case"_toString":var n=i.tags.toString();return e?e(n):n;case"_toObject":var o=i._toObject(i.tags);return e?e(o):o;case"_toJSON":o=i._toObject(i.tags);var s=JSON.stringify(o);return e?e(s):s;case"_toArray":return e?e(i.tags):i.tags}var a=t.split(",");if(a.length>1){var u=i.tags;i.tags=u.concat(a)}else i.tags.push(a[0]);break;case"object":u=i.tags;"[object Object]"===Object.prototype.toString.call(t)&&(t=Object.keys(t).map(function(e){return t[e]})),i.tags=u.concat(t);break;case"function":return t(i.tags)}if(i._clean(),i._fill(),i._updateValue(),i.destroy(),i._setInstance(i),e)return e(i.tags)}return i.tags},event:function(t,e){i.options[t]=e,i._setInstance(i)},options:function(t,e){return t||e?e?(i.options[t]=e,void i._setInstance(i)):i.options[t]:i.options},destroy:function(){var e=t(this).attr("data-uniqid");delete window.inputTags.instances[e]}},"object"==typeof e||!e){e=t.extend(!0,{},t.fn.inputTags.defaults,e),this.each(function(){var n=t(this);n.UNIQID=Math.round(Date.now()/(494*Math.random()-54)),n.DEFAULT_CLASS="inputTags",n.ELEMENT_CLASS=n.DEFAULT_CLASS+"-"+n.UNIQID,n.LIST_CLASS=n.DEFAULT_CLASS+"-list",n.ITEM_CLASS=n.DEFAULT_CLASS+"-item",n.ITEM_CONTENT='<span class="value" title="Cliquez pour éditer">%s</span><i class="close-item">&times</i>',n.FIELD_CLASS=n.DEFAULT_CLASS+"-field",n.ERROR_CLASS=n.DEFAULT_CLASS+"-error",n.ERROR_CONTENT='<p class="'+n.ERROR_CLASS+'">%s</p>',n.AUTOCOMPLETE_LIST_CLASS=n.DEFAULT_CLASS+"-autocomplete-list",n.AUTOCOMPLETE_ITEM_CLASS=n.DEFAULT_CLASS+"-autocomplete-item",n.AUTOCOMPLETE_ITEM_CONTENT='<li class="'+n.AUTOCOMPLETE_ITEM_CLASS+'">%s</li>',n.options=e,n.keys=[13,188,27],n.tags=[],n.options.keys.length>0&&(n.keys=n.keys.concat(n.options.keys)),n.init=function(){n.addClass(n.ELEMENT_CLASS).attr("data-uniqid",n.UNIQID),n.$element=t("."+n.ELEMENT_CLASS),n.$element.hide(),n.build(),n.fill(),n.save(),n.edit(),n.destroy(),n._autocomplete()._init(),n._focus()},n.build=function(){n.$html=t("<div>").addClass(n.LIST_CLASS),n.$input=t("<input>").attr({type:"text",class:n.FIELD_CLASS}),n.$html.insertAfter(n.$element).prepend(n.$input),n.$list=n.$element.next("."+n.LIST_CLASS),n.$list.on("click",function(e){if(t(e.target).hasClass("inputTags-field"))return!1;n.$input.focus()})},n.fill=function(){if(n._getDefaultValues(),0===n.options.tags)return!1;n._concatenate(),n._updateValue(),n._fill()},n._fill=function(){n.tags.forEach(function(t,e){var i=n._validate(t,!1);(!0===i||"max"===i&&e+1<=n.options.max)&&n._buildItem(t)})},n._clean=function(){t("."+n.ITEM_CLASS,n.$list).remove()},n.save=function(){n.$input.on("keyup",function(e){e.preventDefault();var i=e.keyCode||e.which,o=n.$input.val().trim();if(t.inArray(i,n.keys)<0)return!1;if(27===i)return n._cancel(),!1;if(o=188===i?o.slice(0,-1):o,!n._validate(o,!0))return!1;if(n.options.only&&n._exists(o))return n._errors("exists"),!1;if(n.$input.hasClass("is-edit")){var s=n.$input.attr("data-old-value");if(s===o)return n._cancel(),!0;n._update(s,o),n._clean(),n._fill()}else{if(n._autocomplete()._isSet()&&n._autocomplete()._get("only")&&t.inArray(o,n._autocomplete()._get("values"))<0)return n._autocomplete()._hide(),n._errors("autocomplete_only"),!1;if(n._exists(o)){n.$input.removeClass("is-autocomplete"),n._errors("exists");var a=t('[data-tag="'+o+'"]',n.$list);return a.addClass("is-exists"),setTimeout(function(){a.removeClass("is-exists")},300),!1}n._buildItem(o),n._insert(o)}return n._cancel(),n._updateValue(),n.destroy(),n._autocomplete()._build(),n._setInstance(n),n.$input.focus(),!1})},n.edit=function(){n.$list.on("click","."+n.ITEM_CLASS,function(e){if(t(e.target).hasClass("close-item")||!1===n.options.editable||n._autocomplete()._isSet()&&n._autocomplete()._get("only"))return n._cancel(),!0;var i=t(this).addClass("is-edit"),o=t(".value",i).text();n.$input.width(i.outerWidth()).insertAfter(i).addClass("is-edit").attr("data-old-value",o).val(o).focus(),n._bindEvent("selected"),n.$input.on("blur",function(){n._cancel(),n._bindEvent("unselected")})})},n.destroy=function(){t("."+n.ITEM_CLASS,n.$list).off("click").on("click",".close-item",function(){var e=t(this).parent("."+n.ITEM_CLASS),i=t(".value",e).text();e.addClass("is-closed"),setTimeout(function(){n._pop(i),n._updateValue(),e.remove(),n._autocomplete()._build(),n.$input.focus(),n._setInstance(n)},200)})},n._buildItem=function(e){var i=t(n.ITEM_CONTENT.replace("%s",e));t("<span>").addClass(n.ITEM_CLASS+" is-closed").attr("data-tag",e).html(i).insertBefore(n.$input).delay(100).queue(function(){t(this).removeClass("is-closed")})},n._getIndex=function(t){return n.tags.indexOf(t)},n._concatenate=function(){(!1===typeof n.options.max||n.options.max>0)&&n.options.tags.length>n.options.max&&n.options.tags.splice(-Math.abs(n.options.tags.length-n.options.max)),n.tags=n.tags.concat(n.options.tags)},n._getDefaultValues=function(){n.$element.val().length>0?n.tags=n.tags.concat(n.$element.val().split(",")):n.$element.prop("value","")},n._insert=function(t){n.tags.push(t),n._bindEvent(["change","create"])},n._update=function(t,e){var i=n._getIndex(t);n.tags[i]=e,n._bindEvent(["change","update"])},n._pop=function(t){var e=n._getIndex(t);if(e<0)return!1;n.tags.splice(e,1),n._bindEvent(["change","destroy"])},n._cancel=function(){t("."+n.ITEM_CLASS).removeClass("is-edit"),n.$input.removeClass("is-edit is-autocomplete").removeAttr("data-old-value style").val("").appendTo(n.$list)},n._autocomplete=function(){var e=n.options.autocomplete.values;return{_isSet:function(){return e.length>0},_init:function(){if(!n._autocomplete()._isSet())return!1;n._autocomplete()._build()},_build:function(){n._autocomplete()._exists()&&n.$autocomplete.remove(),n.$autocomplete=t("<ul>").addClass(n.AUTOCOMPLETE_LIST_CLASS),n._autocomplete()._get("values").forEach(function(e,i){var o=n.AUTOCOMPLETE_ITEM_CONTENT.replace("%s",e);(t.inArray(e,n.tags)>=0?t(o).addClass("is-disabled"):t(o)).appendTo(n.$autocomplete)}),n._autocomplete()._bindClick(),t(document).not(n.$autocomplete).on("click",function(){n._autocomplete()._hide()})},_bindClick:function(){t(n.$autocomplete).off("click").on("click","."+n.AUTOCOMPLETE_ITEM_CLASS,function(e){if(t(e.target).hasClass("is-disabled"))return!1;n.$input.addClass("is-autocomplete").val(t(this).text()),n._autocomplete()._hide(),n._bindEvent("autocompleteTagSelect"),(e=t.Event("keyup")).which=13,n.$input.trigger(e)})},_show:function(){if(!n._autocomplete()._isSet())return!1;n.$autocomplete.css({left:n.$input[0].offsetLeft,minWidth:n.$input.width()}).insertAfter(n.$input),setTimeout(function(){n._autocomplete()._bindClick(),n.$autocomplete.addClass("is-active")},100)},_hide:function(){n.$autocomplete.removeClass("is-active")},_get:function(t){return n.options.autocomplete[t]},_exists:function(){return void 0!==n.$autocomplete}}},n._updateValue=function(){n.$element.prop("value",n.tags.join(","))},n._focus=function(){n.$input.on("focus",function(){n._bindEvent("focus"),!n._autocomplete()._isSet()||n.$input.hasClass("is-autocomplete")||n.$input.hasClass("is-edit")||n._autocomplete()._show()})},n._toObject=function(t){return t.reduce(function(t,e,n){return t[n]=e,t},{})},n._validate=function(t,e){var i="";switch(!0){case!t:case void 0===t:case 0===t.length:n._cancel(),i="empty";break;case t.length>0&&t.length<n.options.minLength:i="minLength";break;case t.length>n.options.maxLength:i="maxLength";break;case n.options.max>0&&n.tags.length>=n.options.max:n.$input.hasClass("is-edit")||(i="max");break;case n.options.email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)||(i="email")}return!(i.length>0)||(e?n._errors(i):i)},n._exists=function(e){return t.inArray(e,n.tags)>=0},n._errors=function(t){return 0!==t.length&&(n._autocomplete()._exists()&&n.$autocomplete.remove(),n._displayErrors(n.options.errors[t].replace("%s",n.options[t]),t),!1)},n._displayErrors=function(e,i){var o=t(n.ERROR_CONTENT.replace("%s",e)).attr("data-error",i),s=n.options.errors.timeout;return!t("."+n.ERROR_CLASS+'[data-error="'+i+'"]').length&&(o.hide().insertAfter(n.$list).slideDown(),!(!s||s<=0)&&(t("."+n.ERROR_CLASS).on("click",function(){n._collapseErrors(t(this))}),void setTimeout(function(){n._collapseErrors()},s)))},n._collapseErrors=function(e){var i=e||t("."+n.ERROR_CLASS);i.slideUp(300,function(){i.remove()})},n._getInstance=function(){return window.inputTags.instances[n.UNIQID]},n._setInstance=function(t){window.inputTags.instances[n.UNIQID]=n},n._isSet=function(t){return!(void 0===n.options[t]||!1===n.options[t]||n.options[t].length<=0)},n._callMethod=function(t,e){if(void 0===e.options[t]||"function"!=typeof e.options[t])return!1;e.options[t].apply(this,Array.prototype.slice.call(arguments,1))},n._initEvent=function(t,e){if(!t)return!1;switch(typeof t){case"string":e(t,n);break;case"object":t.forEach(function(t,i){e(t,n)})}return!0},n._bindEvent=function(t){return n._initEvent(t,function(t,e){n._callMethod(t,e)})},n._unbindEvent=function(t){return n._initEvent(t,function(t,e){n.options[t]=!1})},n.init(),n._bindEvent("init"),n._setInstance(n)});return{on:function(t,e){window.inputTags.methods.event(t,e)}}}if(window.inputTags.methods[e]){var n=t(this).attr("data-uniqid"),i=window.inputTags.instances[n];return void 0===i?t.error("[undefined instance] No inputTags instance found."):window.inputTags.methods[e].apply(this,Array.prototype.slice.call(arguments,1))}t.error("[undefined method] The method ["+e+"] does not exists.")},t.fn.inputTags.defaults={tags:[],keys:[],minLength:2,maxLength:30,max:6,email:!1,only:!0,init:!1,create:!1,update:!1,destroy:!1,focus:!1,selected:!1,unselected:!1,change:!1,autocompleteTagSelect:!1,editable:!0,autocomplete:{values:[],only:!1},errors:{empty:"Attention, vous ne pouvez pas ajouter un tag vide.",minLength:"Attention, votre tag doit avoir au minimum %s caractères.",maxLength:"Attention, votre tag ne doit pas dépasser %s caractères.",max:"Attention, le nombre de tags ne doit pas dépasser %s.",email:"Attention, l'adresse email que vous avez entré n'est pas valide",exists:"Attention, ce tag existe déjà !",autocomplete_only:"Attention, vous devez sélectionner une valeur dans la liste.",timeout:8e3}}}(jQuery);
